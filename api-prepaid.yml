swagger: '2.0'
info:
  description: |
    Prepago Multicaja - API Alpha

    ** Este es una API en alpha y por lo tanto sufrirá muchos cambios **

    Mientras está en modo alpha, no mantendremos versiones anteriores
  version: '0.10'
  title: API Multicaja (Alpha)
host: 'api.multicaja.cl'
basePath: /v0.10-alpha/
consumes:
  - application/json
produces:
  - application/json
tags:
  - name: prepaid
    description: Métodos públicos de la API de prepago
  - name: prepaid-signup
    description: Registro de usuarios de prepago
paths:
  /prepaid/signup:
    post:
      tags:
        - prepaid-signup
      summary: Inicia un proceso de registro para obtener la tarjeta de prepago
      description:  |
        Inicia un proceso de registro. Retorna `user_signup`, el que indica qué pasos se deben realizar.
        
        Llamadas permitidas cuando el cliente está registrándose:
        ```
          # API-Prepaid
          POST /prepaid/signup
          GET  /prepaid/signup/{signup_id}
          
          # API-Users
          GET  /users/{user_id}
          POST /users/{user_id}/update_personal_data
          POST /users/{user_id}/validate_rut
          POST /users/{user_id}/validate_email
          PUT /users/{user_id}/mail
          POST /users/{user_id}/validate_cellphone
          PUT /users/{user_id}/sms
          POST /users/{user_id}/sign_contract
          POST /users/{user_id}/update_password # debe ser la última llamada
        ```
      parameters:
        - in: body
          name: user_data
          description: RUT y Correo del usuario que quiere obtener una tarjeta
          required: true
          schema:
            $ref: '#/definitions/prepaid_user_signup_new'
      responses:
        '201':
          description: |
            OK - Consulte objeto de respuesta para saber qué pasos faltan y qué información puede mostrar pre llenada.
          schema:
            $ref: '#/definitions/prepaid_user_signup'
        '400':
          description: Error en parámetros, se lanza a cuando un parámetro es requerido y no se ha enviado
          schema:
            $ref: '#/definitions/error_obj'
        '401':
          description: RUT o email corresponden a Cliente que ya tiene clave y que debe autenticarse para realizar esta operación
          schema:
            $ref: '#/definitions/error_obj'
        '403':
          description: Usuario borrado, bloqueado, o ya tiene prepago.
          schema:
            $ref: '#/definitions/error_obj'
        '404':
          description: Cliente no existe
          schema:
            $ref: '#/definitions/error_obj'
        '410':
          description: Cliente ya tiene prepago
          schema:
            $ref: '#/definitions/error_obj'
        '422':
          description: No viene RUT o no viene email
          schema:
            $ref: '#/definitions/error_obj'
        '500':
          description: Error indeterminado, se lanza cuando ocurre un error imprevisto de sistema
          schema:
            $ref: '#/definitions/error_obj'

  /prepaid/signup/{signup_id}:
    get:
      tags:
        - prepaid-signup
      summary: Obtiene el estado de un proceso de registro
      description: |
        Obtiene el estado de un proceso de registro para obtener la tarjeta de prepago. Retorna `user_signup`, el que indica qué pasos falta realizar.
      parameters:
        - in: path
          name: signup_id
          description: ID del proceso de registro pendiente
          required: true
          type: "integer"
      responses:
        '201':
          description: |
            OK - Consulte objeto de respuesta para saber qué pasos faltan y qué información puede mostrar pre llenada.
          schema:
            $ref: '#/definitions/prepaid_user_signup'
        '400':
          description: Error en parámetros, se lanza a cuando un parámetro es requerido y no se ha enviado
          schema:
            $ref: '#/definitions/error_obj'
        '401':
          description: Usuario tiene clave y debe autenticarse para realizar esta operación
          schema:
            $ref: '#/definitions/error_obj'
        '404':
          description: Proceso de registro no existe.
          schema:
            $ref: '#/definitions/error_obj'
        
        
          schema:
            $ref: '#/definitions/error_obj'
        '500':
          description: Error indeterminado, se lanza cuando ocurre un error imprevisto de sistema
          schema:
            $ref: '#/definitions/error_obj'

  /prepaid/topup:
    post:
      tags:
        - prepaid
      summary: Carga una tarjeta
      description: |
        Carga una tarjeta
        
        ### Notas
        * Valida que el usuario esté habilitado para cargar. Esto significa que el usuario debe estar validado hasta nivel 1 o nivel 2.
        * Valida que la carga no exceda los límites
        * Abona a la Cuenta de Traspaso Personal (CTP) y gatilla un proceso asíncrono que debita la CTP para abonar a la Tarjeta de Prepago.
      parameters:
        - in: body
          name: new_topup
          description: Detalle de la carga a realizar
          required: true
          schema:
            $ref: '#/definitions/prepaid_topup_new'
      responses:
        '201':
          description: |
            OK - Carga se realizará en los próximos segundos
          schema:
            $ref: '#/definitions/prepaid_topup'
        '400':
          description: Error en parámetros, se lanza a cuando un parámetro es requerido y no se ha enviado
          schema:
            $ref: '#/definitions/error_obj'
        '404':
          description: Cliente no existe o no tiene prepago
          schema:
            $ref: '#/definitions/error_obj'
        '422':
          description: Carga no exitosa, revise error
          schema:
            $ref: '#/definitions/error_obj'        
        '500':
          description: Error indeterminado, se lanza cuando ocurre un error imprevisto de sistema
          schema:
            $ref: '#/definitions/error_obj'

  /prepaid/topup/reverse:
    post:
      tags:
        - prepaid
      summary: Reversa una carga
      description: |
        Reversa una carga que a) coincida en todos los campos de prepaid_topup_new y b) se haya recibido en las últimas 24 horas.
        
        ### Responderá `201` (éxito) en todos los siguientes casos:
        * Si la carga ya fue reversada, en cuyo caso no hará nada
        * Si la carga nunca se recibió, en cuyo caso no hará nada
        * Si la carga se recibió, y el saldo todavía no se gasta, en cuyo caso reversará el aumento de saldo
        * Si la carga se recibió, y el saldo ya se gastó, en cuyo caso generará un cargo forzado en la tarjeta y enviará una notificación al Cliente para que pague

        ### Responderá error en los siguientes casos:
        * Si es que la carga fue recibida y no está reversada, pero el plazo para reversarla ya expiró. En este caso, no hará nada y responderá `410`
      parameters:
        - in: body
          name: new_topup
          description: Detalle de la carga a realizar
          required: true
          schema:
            $ref: '#/definitions/prepaid_topup_new'
      responses:
        '201':
          description: OK - Reversa exitosa
        '400':
          description: Error en parámetros, se lanza a cuando un parámetro es requerido y no se ha enviado
          schema:
            $ref: '#/definitions/error_obj'
        '404':
          description: Cliente no existe o no tiene prepago
          schema:
            $ref: '#/definitions/error_obj'
        '410':
          description: Plazo para reversar expirado
          schema:
            $ref: '#/definitions/error_obj'        
        '500':
          description: Error indeterminado, se lanza cuando ocurre un error imprevisto de sistema
          schema:
            $ref: '#/definitions/error_obj'

  /prepaid/withdrawal:
    post:
      tags:
        - prepaid
      summary: Retira dinero de una tarjeta
      description: |
        Debita una tarjeta
        
        ### Notas
        * Valida que el usuario esté habilitado para retirar. 
        * Valida que el retiro no exceda los límites
        * Debita la Tarjeta de Prepago y abona a la Cuenta de Traspaso Personal (CTP), luego debita la CTP y abona a la cuenta de destino.
      parameters:
        - in: body
          name: new_withdrawal
          description: Detalle del retiro a realizar
          required: true
          schema:
            $ref: '#/definitions/prepaid_withdrawal_new'
      responses:
        '201':
          description: |
            OK - Retiro realizado
          schema:
            $ref: '#/definitions/prepaid_withdrawal'
        '400':
          description: Error en parámetros, se lanza a cuando un parámetro es requerido y no se ha enviado
          schema:
            $ref: '#/definitions/error_obj'
        '404':
          description: Cliente no existe o no tiene prepago
          schema:
            $ref: '#/definitions/error_obj'
        '422':
          description: Retiro no exitoso, revise error
          schema:
            $ref: '#/definitions/error_obj'
        '500':
          description: Error indeterminado, se lanza cuando ocurre un error imprevisto de sistema
          schema:
            $ref: '#/definitions/error_obj'

  /prepaid/withdrawal/reverse:
    post:
      tags:
        - prepaid
      summary: Reversa un retiro
      description: |
        Reversa un retiro que a) coincida en todos los campos de prepaid_withdrawal_new y b) se haya recibido en las últimas 24 horas.
        
        ### Responderá `201` (éxito) en todos los siguientes casos:
        * Si el retiro ya fue reversado, en cuyo caso no hará nada
        * Si el retiro nunca se recibió, en cuyo caso no hará nada
        * Si el retiro se recibió, y fue procesado, en cuyo caso reintegrará el importe a la tarjeta

        ### Responderá error en los siguientes casos:
        * Si es que el retiro fue recibido y no está reversado, pero el plazo para reversarlo ya expiró. En este caso, no hará nada y responderá `410`
      parameters:
        - in: body
          name: new_withdrawal
          description: Detalle de la carga a realizar
          required: true
          schema:
            $ref: '#/definitions/prepaid_withdrawal_new'
      responses:
        '201':
          description: OK - Reversa exitosa
        '400':
          description: Error en parámetros, se lanza a cuando un parámetro es requerido y no se ha enviado
          schema:
            $ref: '#/definitions/error_obj'
        '404':
          description: Cliente no existe o no tiene prepago
          schema:
            $ref: '#/definitions/error_obj'
        '410':
          description: Plazo para reversar expirado
          schema:
            $ref: '#/definitions/error_obj'
        '500':
          description: Error indeterminado, se lanza cuando ocurre un error imprevisto de sistema
          schema:
            $ref: '#/definitions/error_obj'

  /prepaid/{user_id}/topup:
    get:
      tags:
        - prepaid
      summary: Lista las cargas de un cliente
      description: |
        Retorna un listado con todas las cargas que ha realizado el cliente, junto a su estatus
      parameters:
        - in: path
          name: user_id
          description: ID del Cliente
          required: true
          type: integer
        - in: query
          name: page
          description: Página
          type: integer
      responses:
        '200':
          description: |
            OK - Búsqueda exitosa
          schema:
            type: array
            items:
              $ref: '#/definitions/prepaid_topup'
        '400':
          description: Error en parámetros, se lanza a cuando un parámetro es requerido y no se ha enviado
          schema:
            $ref: '#/definitions/error_obj'
        '404':
          description: Cliente no existe o no tiene prepago
          schema:
            $ref: '#/definitions/error_obj'
        '500':
          description: Error indeterminado, se lanza cuando ocurre un error imprevisto de sistema
          schema:
            $ref: '#/definitions/error_obj'

  /prepaid/processor/notification:
    post:
      summary: Notificación (Callback)
      tags: 
        - prepaid
      description: |
        Notifica una transacción ocurrida en una tarjeta de prepago
        
        **Mensaje invocado por el procesador emisor**
        
        * Si el mensaje de entrada no corresponde an un `raw_transaction_new`, el servicio responderá `422`
      parameters:
        - in: body
          name: transaction
          description: Transacción
          required: true
          schema:
            $ref: '#/definitions/raw_transaction_new'
      responses:
        '200':
          description: OK
        '400':
          description: Error en parámetros, se lanza a cuando un parámetro es requerido y no se ha enviado
          schema:
            $ref: '#/definitions/error_obj'
        '422':
          description: El mensaje `raw_transaction_new` tiene un error
          schema:
            $ref: '#/definitions/error_obj'        
        '500':
          description: Error indeterminado, se lanza cuando ocurre un error imprevisto de sistema
          schema:
            $ref: '#/definitions/error_obj'

  /prepaid/{user_id}/balance:
    get:
      tags:
        - prepaid
      summary: Retorna el saldo de un cliente prepago
      description: |
        Retorna el saldo del cliente prepago

        ### Responderá `404` con código de error en los siguientes casos:
        * 102001: Si el cliente no existe
        * 102003: Si el cliente no está registrado en prepago
        
        ### Responderá `422` con código de error en los siguientes casos:
        * 102002: Cliente bloqueado o borrado
        * 102004: Cliente prepago bloqueado o borrado
        * 106007: Si cliente no tiene saldo o tiene saldo expirado y además tiene una carga pendiente
        * 106008: Si cliente no tiene saldo o tiene saldo expirado y además tiene una carga en proceso
        * 109002: Saldo no disponible (significa que no tenia saldo en cache o su saldo estaba expirado y fallo al consultar el nuevo saldo a tecnocom)

      parameters:
        - in: path
          name: user_id
          description: ID del Cliente
          required: true
          type: integer
      responses:
        '200':
          description: |
            OK - Saldo obtenido
          schema:
            $ref: '#/definitions/prepaid_balance'
        '400':
          description: Error en parámetros, se lanza a cuando un parámetro es requerido y no se ha enviado
          schema:
            $ref: '#/definitions/error_obj'
        '404':
          description: Cliente no existe o no tiene prepago
          schema:
            $ref: '#/definitions/error_obj'
        '422':
          description: Valicación de cliente o saldo
          schema:
            $ref: '#/definitions/error_obj'
        '500':
          description: Error indeterminado, se lanza cuando ocurre un error imprevisto de sistema
          schema:
            $ref: '#/definitions/error_obj'

  /prepaid/{user_id}/simulation/topup:
    post:
      tags:
        - prepaid
      summary: Calculadora de carga
      description: |
        Calculadora de carga
      parameters:
        - in: path
          name: user_id
          description: ID del Cliente
          required: true
          type: integer
        - in: body
          name: simulation_new
          description: Requerimiento de calculo
          required: true
          schema:
            $ref: '#/definitions/simulation_new'
      responses:
        '200':
          description: OK - Respuesta exitosa
          schema:
            $ref: '#/definitions/simulation_topup'
        '400':
          description: Error en parámetros, se lanza a cuando un parámetro es requerido y no se ha enviado
          schema:
            $ref: '#/definitions/error_obj'
        '404':
          description: Cliente no existe o no tiene prepago
          schema:
            $ref: '#/definitions/error_obj'
        '422':
          description: Error en validación
          schema:
            $ref: '#/definitions/error_obj'        
        '500':
          description: Error indeterminado, se lanza cuando ocurre un error imprevisto de sistema
          schema:
            $ref: '#/definitions/error_obj'

  /prepaid/{user_id}/simulation/withdrawal:
    post:
      tags:
        - prepaid
      summary: Calculadora de retiro
      description: |
        Calculadora de retiro
      parameters:
        - in: path
          name: user_id
          description: ID del Cliente
          required: true
          type: integer
        - in: body
          name: simulation_new
          description: Requerimiento de calculo
          required: true
          schema:
            $ref: '#/definitions/simulation_new'
      responses:
        '200':
          description: OK - Respuesta exitosa
          schema:
            $ref: '#/definitions/simulation_withdrawal'
        '400':
          description: Error en parámetros, se lanza a cuando un parámetro es requerido y no se ha enviado
          schema:
            $ref: '#/definitions/error_obj'
        '404':
          description: Cliente no existe o no tiene prepago
          schema:
            $ref: '#/definitions/error_obj'
        '422':
          description: Error en validación
          schema:
            $ref: '#/definitions/error_obj'        
        '500':
          description: Error indeterminado, se lanza cuando ocurre un error imprevisto de sistema
          schema:
            $ref: '#/definitions/error_obj'

  /prepaid/{user_id}/card:
    get:
      tags:
        - prepaid
      summary: Información de la tarjeta prepago
      description: |
        Retorna la información de la tarjeta prepago

        ### Responderá `404` en los siguientes casos:
        * Si el cliente no existe
        * Si el cliente no está registrado en prepago
        
        ### Responderá `422` en los siguientes casos:
        * Si el cliente está registrado en prepago, pero no ha realizado la primera carga
        * Si cliente está registrado en prepago, ya realizo la primera carga y la misma esta en proceso  

      parameters:
        - in: path
          name: user_id
          description: ID del Cliente
          required: true
          type: integer
      responses:
        '200':
          description: |
            OK - Información de la tarjeta prepago
          schema:
            $ref: '#/definitions/prepaid_card'
        '404':
          description: Cliente no existe o no tiene tarjeta prepago
          schema:
            $ref: '#/definitions/error_obj'
        '422':
          description: Cliente tiene primera carga en proceso
          schema:
            $ref: '#/definitions/error_obj'
        '500':
          description: Error indeterminado
          schema:
            $ref: '#/definitions/error_obj'

  /prepaid/:
    get:
      tags:
          - prepaid
      summary: Buscar usuario prepago
      description: |
        Retorna la información del usuario prepago por rut

        ### Responderá `404` en los siguientes casos:
        * Si el cliente no existe
        * Si el cliente no está registrado en prepago

      parameters:
        - in: query
          name: rut
          description: Rut sin puntos, guion ni digito verificador
          required: true
          type: integer
      responses:
        '200':
          description: |
            OK - Información del usuario prepago
          schema:
            $ref: '#/definitions/prepaid_user'
        '404':
          description: Cliente no existe o no tiene tarjeta prepago
          schema:
            $ref: '#/definitions/error_obj'
        '500':
          description: Error indeterminado
          schema:
            $ref: '#/definitions/error_obj'

  /prepaid/{user_id}:
    get:
      tags:
          - prepaid
      summary: Información del usuario prepago
      description: |
        Retorna la información del usuario prepago

        ### Responderá `404` en los siguientes casos:
        * Si el cliente no existe
        * Si el cliente no está registrado en prepago

      parameters:
        - in: path
          name: user_id
          description: ID del Cliente
          required: true
          type: integer
      responses:
        '200':
          description: |
            OK - Información del usuario prepago
          schema:
            $ref: '#/definitions/prepaid_user'
        '404':
          description: Cliente no existe o no tiene tarjeta prepago
          schema:
            $ref: '#/definitions/error_obj'
        '500':
          description: Error indeterminado
          schema:
            $ref: '#/definitions/error_obj'

  /prepaid/{user_id}/transactions:
    get:
      tags:
        - prepaid
      summary: Lista de transacciones
      description: |
        Retorna una lista con las transacciones del cliente

        ### Responderá `404` en los siguientes casos:
        * Si el cliente no existe
        * Si el cliente no está registrado en prepago
      parameters:
        - in: path
          name: user_id
          description: ID del Cliente
          required: true
          type: integer
        - in: query
          name: from
          description: Fecha desde (yyyy-mm-dd)
          type: string
          format: date
        - in: query
          name: to
          description: Fecha hasta (yyyy-mm-dd)
          type: string
          format: date
      responses:
        '200':
          description: |
            OK - Transacciones
          schema:
            type: array
            items: 
              $ref: '#/definitions/prepaid_transaction'
        '404':
          description: Cliente no existe o no tiene tarjeta prepago
          schema:
            $ref: '#/definitions/error_obj'
        '500':
          description: Error indeterminado
          schema:
            $ref: '#/definitions/error_obj'
definitions:

  prepaid_topup_base:
    type: object
    description: |
      Contenido mínimo de una carga
    properties:
      amount:
        $ref: '#/definitions/amount_and_currency_new'
      transaction_id:
        type: string
        description: |
          Identificador único que genera quien invoca a esta API

          ## Consideraciones
          * Debe ser único dentro del día
          * Cargas con este dato repetido dentro del día serán rechazadas
          * Cuando quiera reversar la carga, se le pedirá este dato
        example: "MC_12312309123"

  prepaid_topup_new:
    type: object
    description: |
      Solicitud de carga **(Request)**
    allOf:
      - $ref: "#/definitions/prepaid_topup_base"
      - type: object
        properties:
          rut:
            type: integer
            description: El rut sin puntos, guión, ni dígito verificador
            example: 14569484
          merchant_code:
            type: string
            description: Código de comercio MC
            example: "0023434"
          merchant_category:
            type: integer
            description: Código de actividad del comercio
            example: 112
          merchant_name:
            type: string
            description: Nombre del comercio
            example: "Carnicería el tajo"
  
  prepaid_withdrawal_new:
    type: object
    description: |
      Solicitud de retiro **(Request)**
    allOf:
      - $ref: "#/definitions/prepaid_topup_new"
      - type: object
        properties:
          password:
            type: integer
            description: La clave del usuario
            example: 1324
            
  variable_data:
    type: object
    description: Dato de tipo llave=valor **(Response)**
    required:
      - code
    properties:
      name:
        type: string
        description: Nombre del dato
        example: 'amount_paid'
      value:
        type: string
        description: Valor del dato
        example: "10.500"

  prepaid_topup:
    type: object
    description: |
      Respuesta a solicitud de carga **(Response)**
    allOf:
      - $ref: "#/definitions/prepaid_topup_base"
      - type: object
        properties:
          id:
            type: integer
            description: Identificador de la carga
            example: 7783834
          mc_voucher_type:
            type: string
            enum: ["A", "B"]
            description: |
              Identificador del tipo de voucher que se debe imprimir

              * 'A': Imprimir un voucher de tipo A
              * 'B': Imprimir un voucher de tipo B
            example: 'A'
          mc_voucher_data:
            type: array
            description: Lista de variables para usar en el voucher
            items:
              $ref: '#/definitions/variable_data'
          user_id:
            type: integer
            description: Identificador del Cliente Multicaja afectado
            example: 1291020
          timestamps:
            $ref: '#/definitions/timestamps'

  prepaid_withdrawal:
    type: object
    description: |
      Solicitud de retiro **(Response)**
    allOf:
      - $ref: "#/definitions/prepaid_topup"

  prepaid_user_signup_new:
    type: object
    description: |
      Solicitud de registro de un Cliente Multicaja.cl **(Request)**
    properties:
      email:
        type: string
        description: email del prospecto de cliente
        example: "pepito@gmail.com"
      rut:
        type: integer
        description: rut del prospecto de cliente, sin puntos, guión ni DV
        example: 15776844

  prepaid_user_signup:
    type: object
    description: |
      Solicitud de registro de un Cliente Multicaja.cl **(Response)**
    allOf:
      - $ref: "#/definitions/prepaid_user_signup_new"
      - type: object
        properties:
          id:
            type: integer
            description: Identificador interno. Campo read-only.
            example: 7783834
          user_id:
            type: integer
            description: Identificador del Cliente involucrado en este proceso de registro
            example: 9012331
          name:
            type: string
            description: Nombre o nombres de pila. Si vienen, mostrarlos en la pantalla de datos personales.
            example: "Juan Carlos"
          lastname_1:
            type: string
            description: Apellido paterno. Si viene, mostrarlo en la pantalla de datos personales.
            example: "López"
          cellphone:
            type: integer
            description: Número de celular. Si viene, mostrarlo en la pantalla de ingreso de celular.
            example: 912345678
          terms_and_conditions_list:
            type: array
            items:
              type: string
              description: Link a los términos y condiciones que se deben desplegar para este usuario
              example: 'https://multicaja.cl/tac/contract-v1.3.1.html'
          must_validate_email:
            type: string
            description: Booleano. Si es `true`, el cliente requiere pasar por una validación de correo.
            example: true
          must_validate_cellphone:
            type: string
            description: Booleano. Si es `true`, el cliente requiere pasar por una validación de celular.
            example: true
          must_accept_terms_and_conditions:
            type: string
            description: Booleano. Si es `true`, el cliente requiere pasar por una aceptación de los últimos términos y condiciones.
            example: true
          must_choose_password:
            type: string
            description: Booleano. Si es `true`, el cliente requiere escoger un password.
            example: true
          timestamps:
            $ref: '#/definitions/timestamps'

  timestamps:
    type: object
    description: |
      Fecha de creación y de última modificación **(Response)**
    properties:
      created_at:
        type: string
        format: date-time
        example: "2018-01-14T15:27:42.669Z"
      updated_at:
        type: string
        format: date-time
        example: "2018-03-02T10:03:12.123Z"

  raw_transaction_header_new:
    type: object
    description: |
      Encabezado de transacción notificada en vivo por el procesador **(Request)**
    properties:
      entidad:
        type: string
        description: Código de entidad en el procesador
        example: "9603"
      centro_alta:
        type: string
        description: Sucursal donde se dio de alta al cliente. 4 dígitos.
        example: "0001"
      cuenta:
        type: string
        description: Identificador del cliente. 12 dígitos.
        example: "000000012345"
      pan:
        type: string
        description: PAN truncado.
        example: "411111******1111"

  raw_transaction_body_new:
    type: object
    description: |
      Campos interpretados de transacción notificada en vivo por el procesador **(Request)**
    properties:
      # sd_: Saldo disponible. Sólo para los casos donde existe
      sd_currency_code:
        type: integer
        description: |
          Saldo disponible: Código ISO 4217 (numeric) de la moneda
        example: 152
      sd_value:
        type: string
        description: |
          Saldo disponible: Monto en formato decimal
        example: "1000.00"
      # il: Importe local. OPE-SIA-IM + COD-MONEDA
      il_currency_code:
        type: integer
        description: |
          Importe local: Código ISO 4217 (numeric) de la moneda
        example: 152
      il_value:
        type: string
        description: |
          Importe local: Monto en formato decimal
        example: "1000.00"
      # id: Importe divisa. OPE-DIV-IM + COD-MONEDA-DIV
      id_currency_code:
        type: integer
        description: |
          Importe divisa: Código ISO 4217 (numeric) de la moneda
        example: 152
      id_value:
        type: string
        description: |
          Importe divisa: Monto en formato decimal
        example: "1000.00"
      tipo_tx: # OPE-SIA-CD
        type: integer
        description: Código que identifica el tipo de transacción
        example: 100
      id_mensaje: # IDTM
        type: integer
        description: Identificador del mensaje (4 dìgitos)
        example: 1200
      # CODFUC
      merchant_code:
        type: string
        description: Código único que identifica al comercio
        example: "0008902131"
      # LIT-NOMBRE
      merchant_name:
        type: string
        description: Nombre del comercio
        example: "AMAZON UK"
      # LIT-CD-PAIS
      country_iso_3266_code:
        type: integer
        description: Código ISO 3266-1 (numeric) del país
        example: 152
      country_description:
        type: string
        description: Nombre del país en español
        example: "República de Chile"
      # LIT-CIUDAD
      place_name:
        type: string
        description: Nombre del lugar donde ocurrió el movimiento
        example: "Santiago"
      resolucion_tx: # RSL-SIA-CD
        type: integer
        description: Código que identifica el resultado de la transacción
        example: 100

  raw_transaction_new:
    type: object
    description: |
      Transacción notificada en vivo por el procesador **(Request)**
    properties:
      header:
        $ref: "#/definitions/raw_transaction_header_new"
      body:
        $ref: "#/definitions/raw_transaction_body_new"
      base64_data:
        type: string
        description: String concatenado con todos los campos disponibles, codificado en base 64
        example: "TWFuIGlzIGRpc3Rpbmd1a  ...  XNoZWQsIG5vdCBvS4="

  amount_and_currency_new:
    type: object
    description: Monto en una moneda específica
    required:
      - currency_code
      - value
    properties:
      currency_code:
        type: integer
        description: Código ISO 4217 (numeric) de la moneda
        example: 152
      value:
        type: number
        description: Monto en formato decimal
        example: "1000.00"

  prepaid_balance:
    type: object
    description: Saldo del cliente
    properties:
      balance:
        $ref: "#/definitions/amount_and_currency_new"
      pca_main:
        $ref: "#/definitions/amount_and_currency_new"
      pca_secondary:
        $ref: "#/definitions/amount_and_currency_new"
      updated:
        type: boolean
        description: true o false dependiendo si fue actualizado desde el procesador

  simulation_new:
    type: object
    description: Requerimiento para la calculadora de carga o retiro
    properties:
      amount:
        $ref: "#/definitions/amount_and_currency_new"
      payment_method:
        type: string
        enum: ["WEB", "POS"]
        description: |
          Identificador del tipo simulación

          * 'WEB': Carga o Retiro WEB
          * 'POS': Carga o Retiro POS

  simulation_topup:
    type: object
    description: Respuesta de la calculadora de carga
    properties:
      fee:
        $ref: "#/definitions/amount_and_currency_new"
      amount_to_pay:
        $ref: "#/definitions/amount_and_currency_new"
      pca:
        $ref: "#/definitions/amount_and_currency_new"
      eed:
        $ref: "#/definitions/amount_and_currency_new"

  simulation_withdrawal:
    type: object
    description: Respuesta de la calculadora de retiro
    properties:
      fee:
        $ref: "#/definitions/amount_and_currency_new"
      amount_to_discount:
        $ref: "#/definitions/amount_and_currency_new"

  error_obj:
    type: object
    description: Error que devuelve la api ante un `HTTP 422` **(Response)**
    required:
      - code
    properties:
      code:
        type: integer
        format: int32
        description: Código que representa el error. No será igual al código HTTP.
        example: 1024
      message:
        type: string
        description: Descripción corta del error
        example: "El cliente no pasó la validación"

  prepaid_card:
    type: object
    description: |
      Información de la tarjeta prepago
    properties:
      processor_user_id:
        type: string
        description: |
          Id de usuario en el procesador externo.
        example: "43438500955156352167"
      pan:
        type: string
        description: |
          Número de pan de la tarjeta
        example: "517608XXXXXX4840"
      name_on_card:
        type: string
        description: |
          Nombre impreso en la tarjeta
        example: "Pedro Perez"
      expiration_date:
        type: integer
        description: |
          Fecha de expiración de la tarjeta
          ### Consideraciones
          * Esta en formato `YYYYMM`
        example: 202301
      status:
        type: string
        enum: ["ACTIVE", "PENDING", "LOCKED", "LOCKED_HARD", "EXPIRED"]
        description: |
          Estatus de la tarjeta

          * 'PENDING': Pendiente
          * 'ACTIVE': Activa
          * 'LOCKED': Bloqueada
          * 'LOCKED_HARD': Bloqueada por emisor
          * 'EXPIRED': Expirada
      timestamps:
        $ref: '#/definitions/timestamps'
  
  prepaid_user:
    type: object
    description: |
      Información del usuario prepago
    properties:
      id:
        type: number
        description: |
          Id de usuario prepago
        example: 123456
      user_id:
        type: number
        description: |
          Id de usuario Multicaja
        example: 654321
      rut:
        type: number
        description: |
          Numero de rut del usuario, sin puntos, guion ni digito verificador
        example: 11111111
      status:
        type: string
        enum: ["ACTIVE", "DISABLED"]
        description: |
          Estatus del usuario prepago

          * 'ACTIVE': Activo
          * 'DISABLED': Deshabilitado
      user_level:
        type: string
        enum: ["LEVEL_1", "LEVEL_2"]
        description: |
          Nivel del usuario prepago
          
          * 'LEVEL_1': Cuando el `status` del nombre no esta verificado
          * 'LEVEL_2': Cuando el `status` del rut y nombre esta verificado
      timestamps:
        $ref: '#/definitions/timestamps'
  
  prepaid_transaction:
    type: object
    description: |
      Transacción (Carga, retiro o compra)
    properties:
      date:
        type: string
        format: date
        description: |
          Fecha de la transacción (Fecfac)
        example: "2018-10-05"
      exchange_rate:
        type: number
        description: |
          Cambio Aplicado (CMBAPLI)
        example: 650
      commerce_code:
        type: string
        description: |
          Codigo Comercio (CODCOM)
      economic_concept1:
        type: number
        description: |
          Codigo de concepto economico (CODCONECO)
        example: 1234
      desc_economic_concept1:
        type: string
        description: |
          Descripcion de concepto economico (DESCONECO)
      amount_description_type1:
        type: string
        description: |
          Descripcion tipo de importe (DESTIPIMP)
      application_amount1:
        type: number
        description: |
          Importe de aplicacion (IMPAPLECO)
        example: 1234
      gross_value1:
        type: number
        description: |
          Importe bruto (IMPRUECO)
        example: 1234
      economic_concept2:
        type: number
        description: |
          Codigo de concepto economico (CODCONECO)
        example: 1234
      desc_economic_concept2:
        type: string
        description: |
          Descripcion de concepto economico (DESCONECO)
      amount_description_type2:
        type: string
        description: |
          Descripcion tipo de importe (DESTIPIMP)
      application_amount2:
        type: number
        description: |
          Importe de aplicacion (IMPAPLECO)
        example: 1234
      gross_value2:
        type: number
        description: |
          Importe bruto (IMPRUECO)
        example: 1234
      invoice_description: 
        type: string
        description: |
          Descripcion tipo de factura (DESTIPFAC)
        example: "CARGA POR TRANSFERENCIA"
      extract_account:
        type: number
        description: |
          Numero extracto cuenta  (NUMEXTCTA)
        example: 1234
      extract_transaction:
        type: number
        description: |
          Numero movimiento extracto (NUMMOVEXT)
        example: 1234
      invoice_type:
        type: number
        description: |
          Tipo de factura (TIPOFAC)
        example: 1234
      amount_primary:
        $ref: '#/definitions/amount_and_currency_new'
      amount_secondary:
        $ref: '#/definitions/amount_and_currency_new'
